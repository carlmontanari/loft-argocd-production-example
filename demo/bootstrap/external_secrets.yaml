---
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: fake
spec:
  provider:
    fake:
      data:
      # loft admin password
      - key: "/adminPassword"
        # echo -n "password" | shasum -a 256 -- do *not* quote it! :)
        value: 5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8
        version: "v1"

      # loft connected cluster secrets
      - key: "/cluster/1/config"
        value: "CLUSTER1-REPLACEME"
        version: "v1"
      - key: "/cluster/2/config"
        value: "CLUSTER2-REPLACEME"
        version: "v1"

      # argocd connected cluster 1
      - key: "/cluster/1/argocd-config"
        value: |-
          {
            "tlsClientConfig": {
              "insecure": false,
              "caData": "CLUSTER1-CA-DATA",
              "keyData": "CLUSTER1-KEY-DATA",
              "certData": "CLUSTER1-CERT-DATA"
            }
          }
        version: "v1"
      - key: "/cluster/1/name"
        value: "cluster-1"
        version: "v1"
      - key: "/cluster/1/server"
        value: "https://cluster-1.cluster-1"
        version: "v1"

      # argocd connected cluster 2
      - key: "/cluster/2/argocd-config"
        value: |-
          {
            "tlsClientConfig": {
              "insecure": false,
              "caData": "CLUSTER2-CA-DATA",
              "keyData": "CLUSTER2-KEY-DATA",
              "certData": "CLUSTER2-CERT-DATA"
            }
          }
        version: "v1"
      - key: "/cluster/2/name"
        value: "cluster-2"
        version: "v1"
      - key: "/cluster/2/server"
        value: "https://cluster-2.cluster-2"
        version: "v1"

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: loft-admin-password
  namespace: loft
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: fake
    kind: ClusterSecretStore
  target:
    name: loft-user-secret-admin
  data:
  - secretKey: password
    remoteRef:
      key: /adminPassword
      version: v1

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: loft-cluster-config-cluster-1
  namespace: loft
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: fake
    kind: ClusterSecretStore
  target:
    name: loft-cluster-config-cluster-1
  data:
  - secretKey: config
    remoteRef:
      key: /cluster/1/config
      version: v1

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: loft-cluster-config-cluster-2
  namespace: loft
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: fake
    kind: ClusterSecretStore
  target:
    name: loft-cluster-config-cluster-2
  data:
  - secretKey: config
    remoteRef:
      key: /cluster/2/config
      version: v1

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cluster-config-cluster-1
  namespace: argocd
  annotations:
    managed-by: argocd.argoproj.io
  labels:
    argocd.argoproj.io/secret-type: cluster
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: fake
    kind: ClusterSecretStore
  target:
    name: cluster-config-cluster-1
  data:
  - secretKey: config
    remoteRef:
      key: /cluster/1/argocd-config
      version: v1
  - secretKey: name
    remoteRef:
      key: /cluster/1/name
      version: v1
  - secretKey: server
    remoteRef:
      key: /cluster/1/server
      version: v1

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cluster-config-cluster-2
  namespace: argocd
  annotations:
    managed-by: argocd.argoproj.io
  labels:
    argocd.argoproj.io/secret-type: cluster
spec:
  refreshInterval: 1m
  secretStoreRef:
    name: fake
    kind: ClusterSecretStore
  target:
    name: cluster-config-cluster-2
  data:
  - secretKey: config
    remoteRef:
      key: /cluster/2/argocd-config
      version: v1
  - secretKey: name
    remoteRef:
      key: /cluster/2/name
      version: v1
  - secretKey: server
    remoteRef:
      key: /cluster/2/server
      version: v1